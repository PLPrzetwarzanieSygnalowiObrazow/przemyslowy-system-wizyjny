3.3.4 Zliczanie obiektów

Algorytm wykrywania obiektów (BlobDetector), zwraca odseparowane listy współrzędnych, dla każdego znalezionego typu przedmiotu. Pozwala na określenie lokalizacji każdego z obiektów w przestrzeni obrazu, a co za tym idzie, porównanie jego aktualnego położenia z poprzednim oraz ocenienie, czy ten obiekt został już policzony.

Poniższy zestaw kroków przedstawia algorytm identyfikacji obiektów poruszających się na taśmie transmisyjnej. Każdy typ przedmiotu jest analizowany zgodnie z tym opisem.

1. Sprawdzenie, czy analizowanym zestawem współrzędnych są kolczyki, jeśli tak to w pierwszym kroku należy pogrupować obiekty reprezentujące pojedynczy kolczyk w pary.
- Łączenie w pary jest realizowane na podstawie odległości kolczyków od siebie, obliczane za pomocą odległości Euklidesowej na płaszczyźnie. Warto pamiętać, że każdy kolczyk powinien być połączony, z drugim, który leży najbliżej niego, a także żaden kolczyk nie może należeć do 2 par jednocześnie. Pojedyncze kolczyki które nie mają pary, zostają pominięte w dalszym przetwarzaniu.
- Na podstawie par obiektów obliczane są średnie wartości współrzędnej X, Y, które tworzą współrzędne odpowiadające parze kolczyków, wykorzystywane przy dalszych obliczeniach.

2. Obliczenie tablicy odległości pomiędzy aktualnie analizowanym obiektem, a obiektami które zostały już zliczone na poprzednich klatkach, biorąc pod uwagę tylko te, które nadal mogą znajdować się na obrazie. Korzystając z poniższego wzoru:
[DODAĆ_WZÓR]

3. Wybranie jednego ze zliczonych obiektów, który znajduje się w najmniejsze odległości od tego aktualnie analizowanego. 

4. Sprawdzenie, czy wybrany obiekt jest tym samym, którego aktualnie analizujemy. Podczas sprawdzenia bierzemy pod uwagę:
- średnią prędkość taśmy transmisyjnej
- błąd wynikający z nierównomiernej pracy taśmy
- liczbę klatek, na jakich wybrany obiekt nie został odnaleziony.
[DODAĆ_WZÓR]

5. Jeśli pozycja aktualnie analizowanego obiektu jest zgodna z wyliczeniami, tj. jego przemieszczenie nie wyniosło więcej niż obliczony dystans, to aktualizujemy lokalizację wybranego obiektu z listy już zliczonych i przechodzimy do kroku 2. w celu analizy kolejnego wykrytego obiektu.

6. Jeśli aktualnie analizowany obiekt nie pasuje, do żadnego ze znalezionych już obiektów, to tworzymy nowy wpis - odnalezienie nowego, nie zliczonego wcześniej obiektu. 

Po wykonaniu kroków od 2 do 6 dla każdego z wykrytych obiektów, zwiększamy licznik klatek, na których nie znaleziono danego przedmiotu, o 1, w przypadku wszystkich obiektów, które nie zostały zaktualizowane. Jeśli dany obiekt przekroczył dozwoloną liczbę wcześniej wspomnianych klatek oraz jego ostatnia pozycja w osi X była większa niż wartość graniczna, to oznaczamy taki obiekt jako niewidoczny. 